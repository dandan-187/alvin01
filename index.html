<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Providence Memorial Park Receipt</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap');

  /* Default body styling (overridden by theme classes) */
  body {
    font-family: 'Montserrat', sans-serif;
    margin: 0;
    padding: 1.5rem;
    transition: background 0.3s ease;
  }

  /* Green Park Theme */
  body.green-theme {
    background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
    color: #1a3c34;
  }
  body.green-theme .container {
    background: #ffffff;
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 8px 20px rgba(0, 50, 0, 0.15);
    border: 1px solid #a5d6a7;
  }
  body.green-theme header {
    color: #2e7d32;
  }
  body.green-theme header h1 {
    font-weight: 800;
    font-size: 2rem;
    letter-spacing: 1.8px;
    text-shadow: 0 2px 4px rgba(0, 50, 0, 0.1);
  }
  body.green-theme header h2 {
    font-weight: 600;
    font-size: 1.2rem;
    font-style: italic;
    margin-top: 6px;
    color: #4caf50;
  }
  body.green-theme form {
    margin-bottom: 1.5rem;
    background: #f1f8e9;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: inset 0 2px 5px rgba(0, 50, 0, 0.05);
  }
  body.green-theme label {
    font-weight: 600;
    margin: 12px 0 8px 0;
    color: #1a3c34;
  }
  body.green-theme input[type=text],
  body.green-theme input[type=number],
  body.green-theme select {
    width: 100%;
    padding: 10px 12px;
    font-size: 1rem;
    border: 2px solid #81c784;
    border-radius: 10px;
    box-sizing: border-box;
    background: #ffffff;
    transition: border-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
    position: relative;
    z-index: 1;
  }
  body.green-theme input:focus,
  body.green-theme select:focus {
    border-color: #2e7d32;
    box-shadow: 0 0 8px rgba(46, 125, 50, 0.3);
    outline: none;
  }
  body.green-theme input.focused,
  body.green-theme select.focused {
    transform: scale(1.2);
    z-index: 2;
  }
  body.green-theme button {
    background-color: #4caf50;
    color: white;
    border: none;
    padding: 14px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 1.1rem;
    cursor: pointer;
    margin-top: 18px;
    width: 100%;
    transition: background-color 0.3s ease, transform 0.2s ease;
  }
  body.green-theme button:hover {
    background-color: #388e3c;
    transform: translateY(-2px);
  }
  body.green-theme button.clear-btn {
    background-color: #616161;
    margin-top: 12px;
  }
  body.green-theme button.clear-btn:hover {
    background-color: #424242;
    transform: translateY(-2px);
  }
  body.green-theme .small-btn {
    padding: 8px 12px;
    font-size: 0.9rem;
    border-radius: 10px;
    margin-top: 10px;
    background: #ffca28;
    color: #1a3c34;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
  }
  body.green-theme .small-btn:hover {
    background: #ffb300;
    transform: translateY(-2px);
  }
  body.green-theme .small-btn[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }
  body.green-theme #messengerBtn {
    background-color: #0084FF;
    margin-top: 12px;
  }
  body.green-theme #messengerBtn:hover {
    background-color: #006fdd;
    transform: translateY(-2px);
  }
  body.green-theme #balanceHint {
    font-size: 0.85rem;
    color: #1a3c34;
    margin-left: 6px;
  }
  body.green-theme #fullscreenBtn {
    margin: 10px auto;
    display: block;
  }

  /* Neon Theme */
  body.neon-theme {
    background: linear-gradient(135deg, #1a1a1a 0%, #2e2e2e 100%);
    color: #e0e0e0;
  }
  body.neon-theme .container {
    background: #121212;
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 0 15px rgba(0, 255, 102, 0.5);
    border: 1px solid #00ff66;
  }
  body.neon-theme header {
    color: #00ff66;
    text-shadow: 0 0 10px rgba(0, 255, 102, 0.7);
  }
  body.neon-theme header h1 {
    font-weight: 800;
    font-size: 2rem;
    letter-spacing: 2px;
  }
  body.neon-theme header h2 {
    font-weight: 600;
    font-size: 1.2rem;
    font-style: italic;
    margin-top: 6px;
    color: #00e5ff;
    text-shadow: 0 0 8px rgba(0, 229, 255, 0.5);
  }
  body.neon-theme form {
    margin-bottom: 1.5rem;
    background: #1e1e1e;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: inset 0 0 10px rgba(0, 255, 102, 0.3);
  }
  body.neon-theme label {
    font-weight: 600;
    margin: 12px 0 8px 0;
    color: #e0e0e0;
    text-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
  }
  body.neon-theme input[type=text],
  body.neon-theme input[type=number],
  body.neon-theme select {
    width: 100%;
    padding: 10px 12px;
    font-size: 1rem;
    border: 2px solid #00ff66;
    border-radius: 10px;
    box-sizing: border-box;
    background: #2a2a2a;
    color: #e0e0e0;
    box-shadow: 0 0 10px rgba(0, 255, 102, 0.5);
    transition: border-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease;
    position: relative;
    z-index: 1;
  }
  body.neon-theme input:focus,
  body.neon-theme select:focus {
    border-color: #00e5ff;
    box-shadow: 0 0 15px rgba(0, 229, 255, 0.7);
    outline: none;
  }
  body.neon-theme input.focused,
  body.neon-theme select.focused {
    transform: scale(1.2);
    z-index: 2;
  }
  body.neon-theme button {
    background-color: #00ff66;
    color: #121212;
    border: none;
    padding: 14px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 1.1rem;
    cursor: pointer;
    margin-top: 18px;
    width: 100%;
    box-shadow: 0 0 12px rgba(0, 255, 102, 0.6);
    transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
  }
  body.neon-theme button:hover {
    background-color: #00cc52;
    box-shadow: 0 0 20px rgba(0, 255, 102, 0.8);
    transform: translateY(-2px);
  }
  body.neon-theme button.clear-btn {
    background-color: #ff4081;
    margin-top: 12px;
    box-shadow: 0 0 12px rgba(255, 64, 129, 0.6);
  }
  body.neon-theme button.clear-btn:hover {
    background-color: #d81b60;
    box-shadow: 0 0 20px rgba(255, 64, 129, 0.8);
    transform: translateY(-2px);
  }
  body.neon-theme .small-btn {
    padding: 8px 12px;
    font-size: 0.9rem;
    border-radius: 10px;
    margin-top: 10px;
    background: #ffeb3b;
    color: #121212;
    border: none;
    cursor: pointer;
    box-shadow: 0 0 10px rgba(255, 235, 59, 0.6);
    transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
  }
  body.neon-theme .small-btn:hover {
    background: #fbc02d;
    box-shadow: 0 0 15px rgba(255, 235, 59, 0.8);
    transform: translateY(-2px);
  }
  body.neon-theme .small-btn[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
    box-shadow: none;
    transform: none;
  }
  body.neon-theme #messengerBtn {
    background-color: #0084FF;
    margin-top: 12px;
    box-shadow: 0 0 12px rgba(0, 132, 255, 0.6);
  }
  body.neon-theme #messengerBtn:hover {
    background-color: #006fdd;
    box-shadow: 0 0 20px rgba(0, 132, 255, 0.8);
    transform: translateY(-2px);
  }
  body.neon-theme #balanceHint {
    font-size: 0.85rem;
    color: #e0e0e0;
    margin-left: 6px;
  }
  body.neon-theme #fullscreenBtn {
    margin: 10px auto;
    display: block;
  }

  /* Shared Form Styling */
  h1, h2, h3 { margin: 0; }
  .container {
    max-width: 480px;
    margin: 0 auto;
  }
  header {
    text-align: center;
    margin-bottom: 1.5rem;
  }
  .month-range {
    display: flex;
    gap: 12px;
  }
  .month-range > div {
    flex: 1;
  }

  /* Receipt styling (unchanged) */
  #receipt {
    margin-top: 20px;
    background: #fff8f0;
    border-radius: 12px;
    padding: 20px 30px;
    color: #3a3a3a;
    box-shadow: 0 5px 12px rgba(179,0,0,0.2);
    font-size: 14px;
    display: none;
  }
  #receipt h2 {
    text-align: center;
    color: #b30000;
    font-weight: 900;
    font-size: 1.5rem;
    margin-bottom: 4px;
  }
  #receipt .subheading {
    text-align: center;
    font-style: italic;
    color: #8b0000;
    margin-bottom: 20px;
  }
  #receipt .info-table {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0;
  }
  #receipt .info-table td {
    padding: 6px 8px;
    vertical-align: top;
  }
  #receipt .info-table td.label {
    font-weight: 700;
    color: #8b0000;
    width: 40%;
  }
  #receipt .info-table td.value {
    color: #3a3a3a;
  }
  #receipt .line {
    border-bottom: 1px solid #b3000050;
    margin: 12px 0;
  }
  #receipt .footer {
    margin-top: 20px;
    font-size: 13px;
    color: #660000;
    text-align: center;
    line-height: 1.3;
  }
  #receipt .footer strong {
    color: #b30000;
  }

  /* Responsive */
  @media (max-width: 520px) {
    .month-range {
      flex-direction: column;
    }
    .month-range > div {
      flex: none;
    }
    .container {
      padding: 1.5rem;
    }
  }
</style>
</head>
<body class="green-theme">
<div class="container">
  <header>
    <h1>Providence Memorial Park</h1>
    <h2>Monthly Grave Maintenance Service</h2>
    <button type="button" id="fullscreenBtn" class="small-btn">Go Fullscreen</button>
  </header>

  <form id="inputForm" autocomplete="off">
    <label for="monthlyRate">Monthly Amount (â‚±)</label>
    <input type="text" inputmode="numeric" id="monthlyRate" min="0" step="0.01" placeholder="Enter monthly rate" autocomplete="off" autocorrect="off" autocapitalize="off" required />

    <label for="payerName">Name of Payer</label>
    <input type="text" id="payerName" placeholder="Enter payer's full name" autocomplete="off" autocorrect="off" autocapitalize="off" required />

    <label for="deceasedName">Name of Deceased</label>
    <input type="text" id="deceasedName" placeholder="Enter deceased's full name" autocomplete="off" autocorrect="off" autocapitalize="off" required />

    <label>Payment Period</label>
    <div class="month-range">
      <div>
        <label for="monthFrom" style="font-weight:400; margin-bottom:4px;">From:</label>
        <select id="monthFrom" autocomplete="off" required>
          <option value="" disabled selected>Select month</option>
          <option>January</option><option>February</option><option>March</option><option>April</option>
          <option>May</option><option>June</option><option>July</option><option>August</option>
          <option>September</option><option>October</option><option>November</option><option>December</option>
        </select>
      </div>
      <div>
        <label for="monthTo" style="font-weight:400; margin-bottom:4px;">To:</label>
        <select id="monthTo" autocomplete="off" required>
          <option value="" disabled selected>Select month</option>
          <option>January</option><option>February</option><option>March</option><option>April</option>
          <option>May</option><option>June</option><option>July</option><option>August</option>
          <option>September</option><option>October</option><option>November</option><option>December</option>
        </select>
      </div>
    </div>

    <label for="amountPaid">Amount Paid (â‚±)</label>
    <input type="text" inputmode="numeric" id="amountPaid" min="0" step="0.01" placeholder="0.00" autocomplete="off" autocorrect="off" autocapitalize="off" readonly />

    <!-- Balance months section (hidden by default) -->
    <div id="balanceMonthsSection" style="display:none; margin-top:12px;">
      <label>Balance Period</label>
      <div class="month-range">
        <div>
          <label for="balMonthFrom" style="font-weight:400; margin-bottom:4px;">From:</label>
          <select id="balMonthFrom" autocomplete="off">
            <option value="" disabled selected>Select month</option>
            <option>January</option><option>February</option><option>March</option><option>April</option>
            <option>May</option><option>June</option><option>July</option><option>August</option>
            <option>September</option><option>October</option><option>November</option><option>December</option>
          </select>
        </div>
        <div>
          <label for="balMonthTo" style="font-weight:400; margin-bottom:4px;">To:</label>
          <select id="balMonthTo" autocomplete="off">
            <option value="" disabled selected>Select month</option>
            <option>January</option><option>February</option><option>March</option><option>April</option>
            <option>May</option><option>June</option><option>July</option><option>August</option>
            <option>September</option><option>October</option><option>November</option><option>December</option>
          </select>
        </div>
      </div>

      <label for="balMonthly">Balance Monthly Amount (â‚±)</label>
      <input type="text" inputmode="numeric" id="balMonthly" min="0" step="0.01" placeholder="Balance monthly rate" autocomplete="off" autocorrect="off" autocapitalize="off" />
    </div>

    <label for="balance">Balance (â‚±)</label>
    <div style="display:flex; gap:8px; align-items:center;">
      <input type="text" inputmode="numeric" id="balance" min="0" step="0.01" placeholder="0.00" value="0" autocomplete="off" autocorrect="off" autocapitalize="off" />
      <button type="button" id="addBalanceBtn" class="small-btn" disabled>Add Balance</button>
      <!-- small hint -->
      <span id="balanceHint">Enter &gt;0 then click Add Balance</span>
    </div>

    <button type="button" id="createReceiptBtn">Create Receipt</button>
    <button type="button" id="messengerBtn">Open Messenger</button>
    <button type="button" id="clearBtn" class="clear-btn">Clear</button>
  </form>

  <div id="receipt">
    <h2>ðŸ§¾ Providence Memorial Park</h2>
    <div class="subheading">Monthly Grave Maintenance Service</div>

    <table class="info-table">
      <tr>
        <td class="label">Date:</td>
        <td class="value" id="receiptDate"></td>
      </tr>
      <tr>
        <td class="label">Name of Payer:</td>
        <td class="value" id="receiptPayer"></td>
      </tr>
      <tr>
        <td class="label">Name of Deceased:</td>
        <td class="value" id="receiptDeceased"></td>
      </tr>
      <tr>
        <td class="label">Payment Period:</td>
        <td class="value" id="receiptPeriod"></td>
      </tr>
      <tr>
        <td class="label">Amount Paid:</td>
        <td class="value">â‚±<span id="receiptPaid"></span></td>
      </tr>
      <tr id="receiptBalanceRow">
        <td class="label">Balance:</td>
        <td class="value">â‚±<span id="receiptBalance"></span></td>
      </tr>
    </table>

    <div class="line"></div>

    <div class="footer">
      <p>For inquiries or services such as Bermuda grass planting, grave maintenance, or granite installation and Tent rental with table and chairs, please contact:</p>
      <p><strong>Caretaker Teresa Gaza</strong> â€“ 0965 260 9362</p>
      <p><strong>Caretaker Danilo Gaza</strong> â€“ 0977 683 4583</p>
      <p>Thank you for trusting Providence Memorial Park.</p>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
  // Fullscreen function for mobile devices
  function goFullscreen() {
    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
      if (document.documentElement.requestFullscreen) {
        document.documentElement.requestFullscreen().catch(err => console.log('Fullscreen error:', err));
        // Hide the fullscreen button after clicking
        document.getElementById('fullscreenBtn').style.display = 'none';
      }
    }
  }

  // Attach fullscreen to button
  document.getElementById('fullscreenBtn').addEventListener('click', goFullscreen);

  // Zoom effect for input and select elements
  const inputs = document.querySelectorAll('#inputForm input, #inputForm select');
  inputs.forEach(input => {
    input.addEventListener('focus', () => {
      // Remove .focused from all inputs
      inputs.forEach(i => i.classList.remove('focused'));
      // Add .focused to the current input
      input.classList.add('focused');
    });
    input.addEventListener('blur', () => {
      // Remove .focused when input loses focus
      input.classList.remove('focused');
    });
  });

  // Theme toggle with triple tap
  let tapCount = 0;
  let lastTapTime = 0;
  const TAP_TIMEOUT = 1000; // 1 second window for triple tap
  const interactiveElements = ['INPUT', 'SELECT', 'BUTTON', 'A'];

  document.addEventListener('click', (e) => {
    // Ignore taps on interactive elements
    if (interactiveElements.includes(e.target.tagName)) return;

    const currentTime = Date.now();
    if (currentTime - lastTapTime > TAP_TIMEOUT) {
      tapCount = 1; // Reset if too much time has passed
    } else {
      tapCount++;
    }
    lastTapTime = currentTime;

    if (tapCount === 3) {
      if (document.body.classList.contains('green-theme')) {
        document.body.classList.remove('green-theme');
        document.body.classList.add('neon-theme');
      } else {
        document.body.classList.remove('neon-theme');
        document.body.classList.add('green-theme');
      }
      tapCount = 0; // Reset tap count
    }
  });

  // Elements
  const monthlyRateEl = document.getElementById('monthlyRate');
  const monthFromEl = document.getElementById('monthFrom');
  const monthToEl = document.getElementById('monthTo');
  const amountPaidEl = document.getElementById('amountPaid');

  const balanceEl = document.getElementById('balance');
  const addBalanceBtn = document.getElementById('addBalanceBtn');
  const balanceMonthsSection = document.getElementById('balanceMonthsSection');
  const balMonthFromEl = document.getElementById('balMonthFrom');
  const balMonthToEl = document.getElementById('balMonthTo');
  const balMonthlyEl = document.getElementById('balMonthly');

  const createBtn = document.getElementById('createReceiptBtn');
  const clearBtn = document.getElementById('clearBtn');
  const receipt = document.getElementById('receipt');
  const messengerBtn = document.getElementById('messengerBtn');

  // Receipt fields
  const receiptDateEl = document.getElementById('receiptDate');
  const receiptPayerEl = document.getElementById('receiptPayer');
  const receiptDeceasedEl = document.getElementById('receiptDeceased');
  const receiptPeriodEl = document.getElementById('receiptPeriod');
  const receiptPaidEl = document.getElementById('receiptPaid');
  const receiptBalanceEl = document.getElementById('receiptBalance');
  const receiptBalanceRow = document.getElementById('receiptBalanceRow');

  // Utils
  function getCurrentDateFormatted() {
    const d = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    return d.toLocaleDateString('en-US', options);
  }

  function monthIndex(name) {
    const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
    return months.indexOf(name);
  }

  // inclusive month count, supports wrapping to next year
  function calcMonthsCount(fromName, toName) {
    const fromIdx = monthIndex(fromName);
    const toIdx = monthIndex(toName);
    if (fromIdx === -1 || toIdx === -1) return 0;
    if (toIdx >= fromIdx) return toIdx - fromIdx + 1;
    // wrap around year
    return (12 - fromIdx) + (toIdx + 1);
  }

  // Payment calculation
  function calcPaid() {
    const monthly = parseFloat(monthlyRateEl.value);
    const from = monthFromEl.value;
    const to = monthToEl.value;
    if (!isNaN(monthly) && from && to) {
      const mCount = calcMonthsCount(from, to);
      amountPaidEl.value = (mCount * monthly).toFixed(2);
    } else {
      amountPaidEl.value = '';
    }
  }

  // Balance calculation (when balance details are used)
  function calcBalanceFromMonths() {
    const balMonthly = parseFloat(balMonthlyEl.value);
    const bFrom = balMonthFromEl.value;
    const bTo = balMonthToEl.value;
    if (!isNaN(balMonthly) && bFrom && bTo) {
      const mCount = calcMonthsCount(bFrom, bTo);
      const total = (mCount * balMonthly);
      // write to balance input (user can still edit afterwards)
      balanceEl.value = total.toFixed(2);
    }
  }

  // Enable/disable Add Balance button based on balance input value
  function updateAddBalanceButtonState() {
    const val = parseFloat(balanceEl.value);
    if (!isNaN(val) && val > 0) {
      addBalanceBtn.disabled = false;
      document.getElementById('balanceHint').style.opacity = 1;
    } else {
      addBalanceBtn.disabled = true;
      // hide details if currently visible
      balanceMonthsSection.style.display = 'none';
      document.getElementById('balanceHint').style.opacity = 0.7;
    }
  }

  // When Add Balance clicked: show the months area and default balance monthly to payment monthly
  addBalanceBtn.addEventListener('click', () => {
    // show section
    balanceMonthsSection.style.display = 'block';
    // default bal monthly rate to payment monthly if empty
    if (!balMonthlyEl.value || parseFloat(balMonthlyEl.value) === 0) {
      const pm = parseFloat(monthlyRateEl.value);
      if (!isNaN(pm)) balMonthlyEl.value = pm.toFixed(2);
    }
    // attempt to calculate if months already chosen
    calcBalanceFromMonths();
  });

  // Event listeners for payment fields
  monthlyRateEl.addEventListener('input', () => {
    calcPaid();
    // also update balMonthly's default if balance details visible and user hasn't changed it manually
    if (balanceMonthsSection.style.display === 'block') {
      if (!balMonthlyEl.value || parseFloat(balMonthlyEl.value) === 0) {
        const pm = parseFloat(monthlyRateEl.value);
        if (!isNaN(pm)) balMonthlyEl.value = pm.toFixed(2);
      }
    }
  });
  monthFromEl.addEventListener('change', calcPaid);
  monthToEl.addEventListener('change', calcPaid);

  // Event listeners for balance input & balance months
  balanceEl.addEventListener('input', updateAddBalanceButtonState);
  balMonthFromEl.addEventListener('change', calcBalanceFromMonths);
  balMonthToEl.addEventListener('change', calcBalanceFromMonths);
  balMonthlyEl.addEventListener('input', calcBalanceFromMonths);

  // Initialize payment calculation on load
  window.addEventListener('load', () => {
    if (!monthlyRateEl.value) monthlyRateEl.value = '';
    calcPaid();
    updateAddBalanceButtonState();
  });

  // Create receipt
  createBtn.addEventListener('click', () => {
    const monthly = parseFloat(monthlyRateEl.value);
    const payer = document.getElementById('payerName').value.trim();
    const deceased = document.getElementById('deceasedName').value.trim();
    const monthFrom = monthFromEl.value;
    const monthTo = monthToEl.value;
    const amountPaid = parseFloat(amountPaidEl.value) || 0;
    const balance = parseFloat(balanceEl.value) || 0;

    if (!payer || !deceased || !monthFrom || !monthTo || isNaN(monthly)) {
      alert('Please fill out all required fields.');
      return;
    }

    // Payment period string
    let paymentPeriodStr = `${monthFrom} to ${monthTo} (â‚±${monthly.toFixed(2)}/month)`;
    receiptDateEl.textContent = getCurrentDateFormatted();
    receiptPayerEl.textContent = payer;
    receiptDeceasedEl.textContent = deceased;
    receiptPeriodEl.textContent = paymentPeriodStr;
    receiptPaidEl.textContent = amountPaid.toFixed(2);

    if (balance > 0) {
      receiptBalanceEl.textContent = balance.toFixed(2);
      receiptBalanceRow.style.display = 'table-row';
    } else {
      receiptBalanceRow.style.display = 'none';
    }

    receipt.style.display = 'block';

    // Scroll to receipt
    receipt.scrollIntoView({ behavior: 'smooth' });

    // Automatically save receipt as PNG and trigger download
    html2canvas(receipt, { scale: 2 }).then(canvas => {
      const link = document.createElement('a');
      link.download = 'providence_receipt.png';
      link.href = canvas.toDataURL('image/png');
      document.body.appendChild(link); // Append to body for browser compatibility
      link.click();
      document.body.removeChild(link); // Clean up
    }).catch(error => {
      console.error('Error generating receipt PNG:', error);
      alert('Failed to generate receipt PNG. Please try again.');
    });
  });

  // Clear form and receipt
  clearBtn.addEventListener('click', () => {
    if (confirm('Clear all input fields and receipt?')) {
      document.getElementById('inputForm').reset();
      amountPaidEl.value = '';
      balanceEl.value = '0';
      addBalanceBtn.disabled = true;
      balanceMonthsSection.style.display = 'none';
      receipt.style.display = 'none';
      // Show fullscreen button again after clear
      document.getElementById('fullscreenBtn').style.display = 'block';
      // Remove .focused from all inputs
      inputs.forEach(i => i.classList.remove('focused'));
    }
  });

  // Messenger button click: open @teresatallo.gaza chat and copy details to clipboard
  messengerBtn.addEventListener('click', () => {
    const payer = document.getElementById('payerName').value.trim();
    const deceased = document.getElementById('deceasedName').value.trim();
    const amountPaid = parseFloat(amountPaidEl.value) || 0;

    // Validate required fields
    if (!payer || !deceased || !amountPaid) {
      alert('Please fill out Name of Payer, Name of Deceased, and ensure Amount Paid is calculated.');
      return;
    }

    // Copy formatted text to clipboard
    const textToCopy = `${payer}\n${deceased}\npay ${amountPaid.toFixed(2)}`;
    navigator.clipboard.writeText(textToCopy).then(() => {
      console.log('Text copied to clipboard:', textToCopy);
    }).catch(err => {
      console.error('Failed to copy text:', err);
      alert('Failed to copy text to clipboard. Please try again.');
    });

    // Open Messenger chat with @teresatallo.gaza
    const messengerUrl = 'https://m.me/teresatallo.gaza';
    const link = document.createElement('a');
    link.href = messengerUrl;
    link.style.display = 'none';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link); // Clean up
  });
</script>
</body>
</html>
